!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.fluentTranslationParser={})}(this,function(e){"use strict";var t={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},n=/([\w-]+)|=|(['"])([.\s\S]*?)\2/g,i=/(?:<!--[\S\s]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>)/g,r=Object.create?Object.create(null):{};function s(e,t,n,i,r){var s=t.indexOf("<",i),a=t.slice(i,-1===s?void 0:s);/^\s*$/.test(a)&&(a=" "),(!r&&s>-1&&n+e.length>=0||" "!==a)&&e.push({type:"text",content:a})}function a(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(e){var t=[];for(var n in e)t.push(n+'="'+e[n]+'"');return t.length?" "+t.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(a,"")+"</"+t.name+">"}}var c={parse:function(e,a){a||(a={}),a.components||(a.components=r);var c,f=[],o=-1,u=[],l={},p=!1;return e.replace(i,function(i,r){if(p){if(i!=="</"+c.name+">")return;p=!1}var d,h="/"!==i.charAt(1),g=0===i.indexOf("\x3c!--"),x=r+i.length,m=e.charAt(x);h&&!g&&(o++,"tag"===(c=function(e){var i,r=0,s=!0,a={type:"tag",name:"",voidElement:!1,attrs:{},children:[]};return e.replace(n,function(n){if("="===n)return s=!0,void r++;s?0===r?((t[n]||"/"===e.charAt(e.length-2))&&(a.voidElement=!0),a.name=n):(a.attrs[i]=n.replace(/^['"]|['"]$/g,""),i=void 0):(i&&(a.attrs[i]=i),i=n),r++,s=!1}),a}(i)).type&&a.components[c.name]&&(c.type="component",p=!0),c.voidElement||p||!m||"<"===m||s(c.children,e,o,x,a.ignoreWhitespace),l[c.tagName]=c,0===o&&f.push(c),(d=u[o-1])&&d.children.push(c),u[o]=c),(g||!h||c.voidElement)&&(g||o--,!p&&"<"!==m&&m&&s(d=-1===o?f:u[o].children,e,o,x,a.ignoreWhitespace))}),!f.length&&e.length&&s(f,e,0,0,a.ignoreWhitespace),f},stringify:function(e){return e.reduce(function(e,t){return e+a("",t)},"")}};const f=["{[^$}[>]+}","{ *\\$[^}[>]+}","{[A-Z (]*\\$[^}[>]+}","{ *\\$[^}[]+->","\\*\\[[^[]+\\]","\\[[^[]+\\]","{","}"].join("|"),o=new RegExp(`(${f})`,"g");e.parse=function(e){const t=c.parse(`<dummyI18nTag>${e}</dummyI18nTag>`);return function(e){!function e(t){t&&t.forEach(t=>{if("text"===t.type&&(t.content.indexOf("{")>-1||t.content.indexOf("[")>-1)){const e=t.content.split(o),n=e.length>1?e.reduce((e,t,n)=>{if(n%2==0)e.push({type:"text",content:t});else if(1===t.length&&"{"===t)e.push({type:"openingBracket",raw:t,prefix:"{",suffix:"",content:""});else if(1===t.length&&"}"===t)e.push({type:"closingBracket",raw:t,prefix:"",suffix:"}",content:""});else if(0===t.indexOf("{")&&t.indexOf("$")<0){const n=t.substring(1,t.length-1);e.push({type:"reference",raw:t,prefix:"{",suffix:"}",content:n,reference:n.trim()})}else if(0===t.indexOf("{")&&t.indexOf("$")>-1&&t.indexOf("->")<0&&t.indexOf("(")>-1){const n=t.substring(1,t.length-1);e.push({type:"variable",formatted:!0,raw:t,prefix:"{",suffix:"}",content:n,variable:n.substring(n.indexOf("$")+1,n.indexOf(",")).trim()})}else if(0===t.indexOf("{")&&t.indexOf("$")>-1&&t.indexOf("->")<0){const n=t.substring(1,t.length-1);e.push({type:"variable",raw:t,prefix:"{",suffix:"}",content:n,variable:n.trim().replace("$","")})}else if(0===t.indexOf("{")&&t.indexOf("$")>-1&&t.indexOf("->")>-1){const n=t.substring(1,t.length-2);e.push({type:"selector",raw:t,prefix:"{",suffix:"->",content:n,variable:n.trim().replace("$","")})}else if(0===t.indexOf("[")&&t.indexOf("*")<0){const n=t.substring(1,t.length-1);e.push({type:"variant",isDefault:!1,raw:t,prefix:"[",suffix:"]",content:n,variable:n.trim()})}else if(1===t.indexOf("[")&&0===t.indexOf("*")){const n=t.substring(2,t.length-1);e.push({type:"variant",isDefault:!0,raw:t,prefix:"*[",suffix:"]",content:n,variable:n.trim()})}return e},[]):[];t.children=n}t.children&&e(t.children)})}(e)}(t),t[0].children||[]},e.stringify=function(e){const t=[{type:"tag",name:"dummyI18nTag",voidElement:!1,attrs:void 0,children:e}],n=c.stringify(t);return n.substring(14,n.length-15)},e.astStats=function(e){const t={references:0,variables:0,selectors:0,tags:0};return function e(n){n&&n.forEach(n=>{"tag"===n.type&&t.tags++,"variable"===n.type&&t.variables++,"reference"===n.type&&t.references++,"selector"===n.type&&t.selectors++,n.children&&e(n.children)})}(e),t},Object.defineProperty(e,"__esModule",{value:!0})});
